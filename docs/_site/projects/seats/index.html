<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Qilei Zhang - Personal Website</title>
<meta name="description" content="Find out more about me.">


  <meta name="author" content="Qilei Zhang">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Qilei Zhang - Personal Website">
<meta property="og:title" content="Qilei Zhang - Personal Website">
<meta property="og:url" content="http://localhost:4000/projects/seats/">


  <meta property="og:description" content="Find out more about me.">











  

  


<link rel="canonical" href="http://localhost:4000/projects/seats/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Qilei Zhang",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Qilei Zhang - Personal Website Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/MyLogo.png" alt="Qilei Zhang - Personal Website"></a>
        
        <a class="site-title" href="/">
          Qilei Zhang - Personal Website
          <span class="site-subtitle">My Bio</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/projects/" title="My Projects">Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/work/" title="My Work Experience">Work Experience</a>
            </li><li class="masthead__menu-item">
              <a href="/publications/" title="My Publications">Publications</a>
            </li><li class="masthead__menu-item">
              <a href="/skills/" title="My Courses & Skills">Skills</a>
            </li><li class="masthead__menu-item">
              <a href="/photo/" title="My photography">Photography</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="http://localhost:4000/">
        <img src="/assets/images/profile_logo.png" alt="Qilei Zhang" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/" itemprop="url">Qilei Zhang</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Ph.D. Candidate in Industrial Management at Purdue University. Interested in data science, machine learning, and aviation.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">West Lafayette, IN</span>
        </li>
      

      
        
          
            <li><a href="mailto:zhan3599@purdue.edu" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-at" aria-hidden="true"></i><span class="label">zhan3599@purdue.edu</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/qilei-zhang/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin-in" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://scholar.google.com/citations?user=3JCGvPMAAAAJ&hl=en" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-google" aria-hidden="true"></i><span class="label">Google Scholar</span></a></li>
          
        
          
        
          
            <li><a href="https://github.com/benkwhite" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.instagram.com/benkwhite/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          
          


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <!-- # Alpha Market Seat Allocation Forecasting Using RNNs -->
<h2 id="introduction">Introduction</h2>
<p>This project focuses on predicting the number of seats likely to be arranged for a given airline route in specified future quarters. The prediction model is built around Recurrent Neural Networks (RNN), which have shown effectiveness in dealing with sequential data. The historical dataset used for training the model has been sourced from Diio Mi, which consists of details related to airline performance and future schedules.</p>

<h2 id="model-training">Model Training</h2>
<p>To train the model, follow these steps:</p>

<ol>
  <li><strong>Data Preparation</strong>:
    <ul>
      <li>Download the necessary data from Diio Mi and place it in the data folder. The data should encompass airline performance information from previous quarters as well as the scheduled data for the upcoming quarters. The specific files to be downloaded are:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">Schedule_Monthly_Summary_Report_Conti.csv</code>: This file contains historical data on quarterly airline schedules.</li>
          <li><code class="language-plaintext highlighter-rouge">Airline_Performance_Report_Conti.csv</code>: This file provides an overview of the airline’s performance in past quarters.</li>
          <li><code class="language-plaintext highlighter-rouge">Schedule_Monthly_Summary_2023Qxxxx.csv</code>: This file provides scheduled data for the quarters of 202x.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Code Setup</strong>:
    <ul>
      <li>Organize the code files in a dedicated folder. This could be a local directory on your machine, a folder in Google Colab, or a workspace in Azure Databricks. The required files are:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">RNN_model.py</code>: This is the main script where the RNN model is defined and trained.</li>
          <li><code class="language-plaintext highlighter-rouge">RNN_apply_ind.py</code>: This script is used to apply the trained model for testing data predictions.</li>
          <li><code class="language-plaintext highlighter-rouge">parameters.json</code>: This file contains configurable parameters for the model.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>Parameter Adjustment</strong>:
    <ul>
      <li>Modify the parameters in the <code class="language-plaintext highlighter-rouge">parameters.json</code> file as per your requirement. This allows you to fine-tune various aspects of the model like the number of layers, learning rate, number of epochs, etc.</li>
    </ul>
  </li>
</ol>

<h2 id="shortcut-tasks">Shortcut Tasks</h2>

<p>The <code class="language-plaintext highlighter-rouge">run.ipynb</code> notebook contains quick steps for performing various tasks. These tasks include:</p>
<ul>
  <li>Data Validation: Testing the latest quarters’ data against settled schedule data.</li>
  <li>Data Update: Adding new performance data and seat data to existing datasets, when new performance data becomes available.</li>
  <li>Data Split Test: Checking the correctness of data splitting.</li>
  <li>Hyperparameter Tuning: Automated hyperparameter tuning with results recording (intended for execution on Azure Databricks).</li>
  <li>Batch Download: Downloading multiple files from Azure Databricks to local machine.</li>
  <li>Future Predictions: Making predictions for future quarters, without the comparison of schedule data.</li>
</ul>

<h2 id="execution-environment">Execution Environment</h2>
<h3 id="local-machine-not-recommended-due-to-speed-limitations-but-useful-for-testing-the-code">Local Machine (Not recommended due to speed limitations, but useful for testing the code)</h3>

<p>To execute the model on a local machine:</p>

<ol>
  <li><strong>Model Training and Parameter Setup</strong>:
    <ul>
      <li>You can either run the code directly or within a new Jupyter Notebook. Set the necessary parameters and ensure that a <code class="language-plaintext highlighter-rouge">parameters.json</code> file is created with default or adjusted values.</li>
    </ul>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1"># Define essential parameters
</span>    <span class="n">folder_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s">'C:\Users\qilei.zhang\OneDrive - Frontier Airlines\Documents\Data\USconti'</span>
    <span class="n">seats_file_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s">'\Schedule_Monthly_Summary_Report_Conti.csv'</span>
    <span class="n">perf_file_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s">'\Airline_Performance_Report_Conti.csv'</span>

    <span class="c1"># Ensure the existence of parameters.json, if not create one with default settings.
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="s">'parameters.json'</span><span class="p">):</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">"resume_training"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s">"MSE_or_GaussianNLLLoss"</span><span class="p">:</span> <span class="s">"MSE"</span><span class="p">,</span>
            <span class="s">"pred_num_quarters"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s">"seq_num"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s">"if_add_time_info"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
            <span class="s">"learning_rate"</span><span class="p">:</span> <span class="mf">1e-04</span><span class="p">,</span>
            <span class="s">"momentum"</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
            <span class="s">"batch_size"</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
            <span class="s">"epochs"</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s">"num_workers"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s">"shuffle"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s">"fixed_seed"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s">"rnn_type"</span><span class="p">:</span> <span class="s">"LSTM"</span><span class="p">,</span>
            <span class="s">"n_layers"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s">"drop_prob"</span><span class="p">:</span> <span class="mf">0.35</span><span class="p">,</span>
            <span class="s">"num_heads"</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
            <span class="s">"start_year"</span><span class="p">:</span> <span class="mi">2004</span><span class="p">,</span>
            <span class="s">"checkpoint_file_name"</span><span class="p">:</span> <span class="s">"checkpoint.pth"</span><span class="p">,</span>
            <span class="s">"bidirectional"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> 
            <span class="s">"if_skip"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> 
            <span class="s">"if_feed_drop"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> 
            <span class="s">"if_feed_norm"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="s">"start_quarter"</span><span class="p">:</span> <span class="s">"Q1 2023"</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'parameters.json'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    
    <span class="c1"># Retrieve parameters from the JSON file.
</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'parameters.json'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">Namespace</span><span class="p">(</span><span class="o">**</span><span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    
    <span class="n">main_program</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">seats_file_name</span><span class="p">,</span> <span class="n">perf_file_name</span><span class="p">)</span>
</code></pre></div></div>

<ol>
  <li><strong>Model Application</strong>:
    <ul>
      <li>Test the trained model by feeding it future quarters’ schedule data to make predictions.</li>
    </ul>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">RNN_apply_ind</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">json</span><span class="p">,</span> <span class="n">argparse</span>

<span class="n">folder_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s">'C:\Users\qilei.zhang\OneDrive - Frontier Airlines\Documents\Data\USconti'</span>
<span class="n">seats_file_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s">'\Schedule_Monthly_Summary_Report_Conti.csv'</span>
<span class="n">perf_file_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s">'\Airline_Performance_Report_Conti.csv'</span>
<span class="n">apply_file_name</span> <span class="o">=</span> <span class="s">'\Schedule_Monthly_Summary_2023Q1234.csv'</span>
<span class="c1"># Load parameters from the JSON file.
</span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="s">'parameters.json'</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"parameters.json does not exist, Find the file and put it in the same folder as this file"</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'parameters.json'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">Namespace</span><span class="p">(</span><span class="o">**</span><span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

<span class="n">RNN_apply_ind</span><span class="p">.</span><span class="n">main_apply</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">seats_file_name</span><span class="p">,</span> <span class="n">perf_file_name</span><span class="p">,</span> <span class="n">apply_file_name</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="google-colab">Google Colab</h3>
<p>To run the model using Google Colab, follow these steps:</p>

<ol>
  <li>
    <p><strong>Upload Code Files</strong>: Upload the necessary code files to your Colab directory. The data files should already exist in the Colab folder.</p>
  </li>
  <li>
    <p><strong>Setup Runtime</strong>: Change the runtime type to GPU for accelerated computation.</p>
  </li>
  <li><strong>Mount Google Drive</strong>: Import the drive module from <code class="language-plaintext highlighter-rouge">google.colab</code> and mount your Google Drive as follows:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
 <span class="n">drive</span><span class="p">.</span><span class="n">mount</span><span class="p">(</span><span class="s">'/content/drive'</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Upload Parameters File</strong>: Upload the <code class="language-plaintext highlighter-rouge">parameters.json</code> file to your Colab directory. Verify the available GPU and RAM resources:</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">import</span> <span class="nn">argparse</span>
 <span class="kn">import</span> <span class="nn">json</span>

 <span class="n">gpu_info</span> <span class="o">=</span> <span class="err">!</span><span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span>
 <span class="n">gpu_info</span> <span class="o">=</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">gpu_info</span><span class="p">)</span>
 <span class="k">if</span> <span class="n">gpu_info</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'failed'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
 <span class="k">print</span><span class="p">(</span><span class="s">'Not connected to a GPU'</span><span class="p">)</span>
 <span class="k">else</span><span class="p">:</span>
 <span class="k">print</span><span class="p">(</span><span class="n">gpu_info</span><span class="p">)</span>

 <span class="kn">from</span> <span class="nn">psutil</span> <span class="kn">import</span> <span class="n">virtual_memory</span>
 <span class="n">ram_gb</span> <span class="o">=</span> <span class="n">virtual_memory</span><span class="p">().</span><span class="n">total</span> <span class="o">/</span> <span class="mf">1e9</span>
 <span class="k">print</span><span class="p">(</span><span class="s">'Your runtime has {:.1f} gigabytes of available RAM</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">ram_gb</span><span class="p">))</span>

 <span class="k">if</span> <span class="n">ram_gb</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
 <span class="k">print</span><span class="p">(</span><span class="s">'Not using a high-RAM runtime'</span><span class="p">)</span>
 <span class="k">else</span><span class="p">:</span>
 <span class="k">print</span><span class="p">(</span><span class="s">'You are using a high-RAM runtime!'</span><span class="p">)</span>

 <span class="s">"""
 Use it only on Google Colab.
 """</span>

 <span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>

 <span class="n">uploaded</span> <span class="o">=</span> <span class="n">files</span><span class="p">.</span><span class="n">upload</span><span class="p">()</span>

 <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">uploaded</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
 <span class="k">print</span><span class="p">(</span><span class="s">'User uploaded file "{name}" with length {length} bytes'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
     <span class="n">name</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">uploaded</span><span class="p">[</span><span class="n">fn</span><span class="p">])))</span>
</code></pre></div>    </div>
  </li>
  <li>Run the Training Code: Start the training process by executing the main_program function from RNN_model.py.
```python
import RNN_model</li>
</ol>

<p>folder_path = r’/content/drive/MyDrive/Data/’
seats_file_name = r’Schedule_Monthly_Summary_Report_Conti.csv’
perf_file_name = r’Airline_Performance_Report_Conti.csv’
apply_file_name = r’Schedule_Monthly_Summary_2023Q234.csv’</p>

<h1 id="load-parameters-from-the-json-file">Load parameters from the JSON file.</h1>
<p>with open(‘parameters.json’, ‘r’) as f:
    args = argparse.Namespace(**json.load(f))</p>

<p>RNN_model.main_program(args, folder_path, seats_file_name, perf_file_name)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
6. **Run the Validation Code**: Validate the trained model by using the `main_apply` function from `RNN_apply_ind.py`.
```python
import RNN_apply_ind, os
# Load parameters from the JSON file.s
if not os.path.exists('parameters.json'):
    print("parameters.json does not exist, Find the file and put it in the same folder as this file")
with open('parameters.json', 'r') as f:
    args = argparse.Namespace(**json.load(f))

RNN_apply_ind.main_apply(args, folder_path, seats_file_name, perf_file_name, apply_file_name)
</code></pre></div></div>

<ol>
  <li>Save and Download Files: After the model training and validation, remember to download the model and checkpoint files to your local machine. You’ll find:
    <ul>
      <li>The model file (<code class="language-plaintext highlighter-rouge">model.pth</code>) in the <code class="language-plaintext highlighter-rouge">model</code> folder, which is used for future predictions.</li>
      <li>The checkpoint file (<code class="language-plaintext highlighter-rouge">checkpoint.pth</code>) in the <code class="language-plaintext highlighter-rouge">checkpoint folder</code>, which saves the training state for future training purposes.</li>
    </ul>
  </li>
</ol>

<h3 id="azure-databricks">Azure Databricks</h3>
<p>To run the model using Azure Databricks, follow these steps:</p>

<ol>
  <li>
    <p><strong>Navigate to Files Directory</strong>: Change the directory to where your files are located with <code class="language-plaintext highlighter-rouge">%cd /dbfs/FileStore/SeatPre/RunModelvX</code>.</p>
  </li>
  <li><strong>Install Required Packages</strong>: Install the necessary Python packages for this project. If you’re using a GPU cluster, make sure to install the GPU versions of PyTorch, torchvision, and torchaudio.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">airportsdata</span>
 <span class="err">!</span><span class="n">pip3</span> <span class="n">install</span> <span class="n">torch</span> <span class="n">torchvision</span> <span class="n">torchaudio</span> <span class="o">--</span><span class="n">index</span><span class="o">-</span><span class="n">url</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="p">.</span><span class="n">pytorch</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">whl</span><span class="o">/</span><span class="n">cu118</span> <span class="c1"># if the GPU cluster is used
</span> <span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">dask</span>
 <span class="kn">import</span> <span class="nn">argparse</span>
 <span class="kn">import</span> <span class="nn">json</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Verify GPU Usage</strong>: Confirm that your code is set to use GPU with:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Run the Training Code</strong>: Execute the main_program function from <code class="language-plaintext highlighter-rouge">RNN_model.py</code> to start the training process.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">import</span> <span class="nn">RNN_model</span>

 <span class="n">folder_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s">'/dbfs/FileStore/SeatPre/'</span>
 <span class="n">seats_file_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s">'Schedule_Monthly_Summary_Report_Conti.csv'</span>
 <span class="n">perf_file_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s">'Airline_Performance_Report_Conti.csv'</span>
 <span class="n">apply_file_name</span> <span class="o">=</span> <span class="sa">r</span><span class="s">'Schedule_Monthly_Summary_2023Q1234.csv'</span>

 <span class="c1"># Load parameters from the JSON file.
</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'parameters.json'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
     <span class="n">args</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">Namespace</span><span class="p">(</span><span class="o">**</span><span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

 <span class="n">RNN_model</span><span class="p">.</span><span class="n">main_program</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">seats_file_name</span><span class="p">,</span> <span class="n">perf_file_name</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li><strong>Run the Validation Code</strong>: Run the main_apply function from <code class="language-plaintext highlighter-rouge">RNN_apply_ind.py</code> to validate the trained model.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">import</span> <span class="nn">RNN_apply_ind</span><span class="p">,</span> <span class="n">os</span>
 <span class="c1"># Load parameters from the JSON file.s
</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="s">'parameters.json'</span><span class="p">):</span>
     <span class="k">print</span><span class="p">(</span><span class="s">"parameters.json does not exist, Find the file and put it in the same folder as this file"</span><span class="p">)</span>
 <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'parameters.json'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
     <span class="n">args</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">Namespace</span><span class="p">(</span><span class="o">**</span><span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

 <span class="n">RNN_apply_ind</span><span class="p">.</span><span class="n">main_apply</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">,</span> <span class="n">seats_file_name</span><span class="p">,</span> <span class="n">perf_file_name</span><span class="p">,</span> <span class="n">apply_file_name</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="special-notes-methods-to-download-files-from-azure-databricks-to-local-machine">Special Notes: Methods to Download Files from Azure Databricks to Local Machine</h4>
<p>You can retrieve the model and checkpoint files using either the Databricks CLI or via your web browser:</p>

<ol>
  <li>
    <p><strong>Databricks CLI</strong>: Use the CLI to download files to your local machine. First, install the Databricks CLI with <code class="language-plaintext highlighter-rouge">pip install databricks-cli</code>. Set up an access token with <code class="language-plaintext highlighter-rouge">databricks configure --token</code> and check the connection with <code class="language-plaintext highlighter-rouge">databricks fs ls dbfs:/</code>. Finally, download your desired file with <code class="language-plaintext highlighter-rouge">databricks fs cp &lt;file_path_on_dbfs&gt; &lt;local_path&gt;</code>, e.g., <code class="language-plaintext highlighter-rouge">databricks fs cp dbfs:/FileStore/test.txt ./test.txt</code>.</p>
  </li>
  <li>
    <p><strong>Web Browser</strong>: You can also directly download the files via your web browser by navigating to the URL <code class="language-plaintext highlighter-rouge">https://&lt;databricks_instance&gt;/files/path/to/file?o=&lt;workspaceID&gt;</code>. For example, <code class="language-plaintext highlighter-rouge">https://adb-7094xxxxx.11.azuredatabricks.net/files/SeatPre/RunModelv5/model/model.pth?o=7094xxxxxx</code></p>
  </li>
</ol>

<h2 id="key-considerations">Key Considerations</h2>
<ol>
  <li><strong>Learning Rate</strong>: Ensure the learning rate is not set too high. It is recommended not to exceed 0.001.</li>
  <li><strong>Start Quarter</strong>: Update the <code class="language-plaintext highlighter-rouge">start_quarter</code> in <code class="language-plaintext highlighter-rouge">parameters.json</code> to the year when the performance data ends.</li>
  <li><strong>Data Columns</strong>: Always add a <code class="language-plaintext highlighter-rouge">Date</code> column when introducing new performance data since single-quarter download may omit this column.</li>
  <li><strong>Data Merge</strong>: The process to merge updated performance data with existing data is outlined in <code class="language-plaintext highlighter-rouge">run.ipynb</code>.</li>
  <li><strong>Validation Schedule Data</strong>: Make sure the validation schedule data begins from the quarter following the last quarter of the performance data.</li>
  <li><strong>LabelEncoder Consistency</strong>: Be aware that the version of LabelEncoder (from sklearn) might vary across platforms. For consistency, it’s best to train and test the model on the same platform.</li>
</ol>

<h2 id="version-history">Version History</h2>
<h3 id="enhancements-and-new-features">Enhancements and New Features</h3>
<ol>
  <li>Introduced a choice between Mean Squared Error (MSE) and Gaussian Negative Log Likelihood (GaussianNLLLoss) for the loss function. GaussianNLLLoss is the default. For MSE, if a confidence interval is desired, the Monte Carlo method must be used, although results have been sub-optimal.</li>
  <li>Optimized root folder organization, categorizing files into specific folders. New folders are automatically created as needed.</li>
  <li>Encapsulated the main function into <code class="language-plaintext highlighter-rouge">main_program()</code> for clarity and easy execution.</li>
  <li>Consolidation: All validation functions have been consolidated into a single file, <code class="language-plaintext highlighter-rouge">RNN_apply_ind.py</code>. Running this script will yield validation results.
    <ul>
      <li>An example of the original data split method for predicting three quarters of data is available here: <img src="./assets/images/DataSplit1.jpg" alt="Data Split" /></li>
      <li>An updated example of data split for predicting three quarters of data, with a two-quarter skip, is provided here: <img src="./assets/images/DataSplit2.jpg" alt="Data Split" /></li>
      <li>Please note that while these quarters are “skipped” for prediction, the scheduled seat data from these quarters are still included as input features. However, it is noticed that the model lost its certain predictive power of the seasonality by adding the skipped quarters’ data as input features although the model prediction accuracy is improved.</li>
      <li>The assumption here is that the fixed schedule for the next two quarters is known at the time of the last published performance data.</li>
      <li>It is worth mentioning that while the model is capable of predicting an arbitrary number of quarters, it is often advantageous to limit these predictions to fewer quarters for two main reasons:
        <ul>
          <li><strong>Data Perspective</strong>: By predicting fewer quarters, more historical data is available for model training, especially the stable data after the pandemic.</li>
          <li><strong>Model Perspective</strong>: Predicting fewer quarters allows the model to focus on a smaller time frame, reducing the variables that need to be balanced within the loss function.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Moved all parameters to a <code class="language-plaintext highlighter-rouge">parameters.json</code> file for easy modification.</li>
  <li>Optimized several functions for efficiency and performance.</li>
  <li>Added interactive features prompting users to select desired route results.</li>
  <li>Introduced a checkpoint function to save the model and optimizer for later use.</li>
  <li>Bug Fixes: Various bugs have been addressed, such as handling inconsistent numbers of departure and arrival airports in the schedule and performance files, and not restricting the start year to the beginning year of the dataset.</li>
  <li>Current Quarter Skipping: The model now allows skipping of current quarter(s) to facilitate predictions for future quarters.</li>
  <li>Hyperparameter Tuning: Added functionality for automatic hyperparameter tuning and result recording.</li>
  <li>Future Predictions: Implemented a feature to predict future quarters, in absence of comparison schedule data.</li>
</ol>

<h3 id="deprecated-features">Deprecated Features</h3>
<p>Several outdated functions have been removed in the current version.</p>

        
      </section>

      <footer class="page__meta">
        
        


        

      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
          <li><a href="https://www.instagram.com/benkwhite/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> My Instagram</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<p> View <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span> Times. You are the <span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span> visitors. Welcome! </p>
<!-- <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<span class="counter" id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> 
<span class="hits">Hits</span> -->
<!-- Total <span id="busuanzi_value_site_pv"></span> views. -->


<div class="page__footer-copyright">&copy; 2023 Qilei Zhang. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/benkwhite" rel="nofollow">Me</a>.</div>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
